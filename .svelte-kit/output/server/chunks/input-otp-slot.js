import{v as t,p as e,k as n,m as r,s as i,l as s}from"./index.js";import{c as o}from"./button2.js";import{s as a,a as p,d as l,e as u,c,b as h,m as d}from"./create-id.js";import{w as m,n as f}from"./noop.js";import{P as v,D as g}from"./dom-context.svelte.js";import"clsx";import{e as x}from"./context.js";function S({containerRef:t,inputRef:e,pushPasswordManagerStrategy:n,isFocused:r,domContext:i}){let s=!1;return{get hasPwmBadge(){return s},get willPushPwmBadge(){return function(){const t=n.current;return"none"!==t&&("increase-width"===t&&s)}()},PWM_BADGE_SPACE_WIDTH:"40px"}}const w=l({component:"pin-input",parts:["root","cell"]}),b=["Backspace","Delete","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Escape","Enter","Tab","Shift","Control","Meta"];class P{static create(t){return new P(t)}opts;attachment;#t=a(null);#e=!1;inputAttachment=p(this.#t);#n=a(!1);#r=null;#i=null;#s=new v(()=>this.opts.value.current??"");#o=t(()=>"string"==typeof this.opts.pattern.current?new RegExp(this.opts.pattern.current):this.opts.pattern.current);#a={prev:[null,null,"none"],willSyntheticBlur:!1};#p;#l;domContext;constructor(t){this.opts=t,this.attachment=p(this.opts.ref),this.domContext=new g(t.ref),this.#l={value:this.opts.value,isIOS:"undefined"!=typeof window&&window?.CSS?.supports("-webkit-touch-callout","none")},this.#p=S({containerRef:this.opts.ref,inputRef:this.#t,isFocused:this.#n,pushPasswordManagerStrategy:this.opts.pushPasswordManagerStrategy,domContext:this.domContext}),m([()=>this.opts.value.current,()=>this.#t.current],()=>{!function(t,e){const n=e.setTimeout(t,0),r=e.setTimeout(t,10),i=e.setTimeout(t,50)}(()=>{const t=this.#t.current;if(!t)return;t.dispatchEvent(new Event("input"));const e=t.selectionStart,n=t.selectionEnd,r=t.selectionDirection??"none";null!==e&&null!==n&&(this.#r=e,this.#i=n,this.#a.prev=[e,n,r])},this.domContext)})}onkeydown=t=>{const e=t.key;b.includes(e)||t.ctrlKey||t.metaKey||e&&this.#o()&&!this.#o().test(e)&&t.preventDefault()};#u=t(()=>({position:"relative",cursor:this.opts.disabled.current?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}));#c=t(()=>({id:this.opts.id.current,[w.root]:"",style:this.#u(),...this.attachment}));get rootProps(){return this.#c()}set rootProps(t){return this.#c(t)}#h=t(()=>({style:{position:"absolute",inset:0,pointerEvents:"none"}}));get inputWrapperProps(){return this.#h()}set inputWrapperProps(t){return this.#h(t)}#d=t(()=>({position:"absolute",inset:0,width:this.#p.willPushPwmBadge?`calc(100% + ${this.#p.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:this.#p.willPushPwmBadge?`inset(0 ${this.#p.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:this.opts.textAlign.current,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--bits-pin-input-root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}));#m(){const t=this.domContext.getDocument(),e=t.createElement("style");if(e.id="pin-input-style",t.head.appendChild(e),e.sheet){const t="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";E(e.sheet,"[data-pin-input-input]::selection { background: transparent !important; color: transparent !important; }"),E(e.sheet,`[data-pin-input-input]:autofill { ${t} }`),E(e.sheet,`[data-pin-input-input]:-webkit-autofill { ${t} }`),E(e.sheet,"@supports (-webkit-touch-callout: none) { [data-pin-input-input] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),E(e.sheet,"[data-pin-input-input] + * { pointer-events: all !important; }")}}#f=()=>{const t=this.#t.current,e=this.opts.ref.current;if(!t||!e)return;if(this.domContext.getActiveElement()!==t)return this.#r=null,void(this.#i=null);const n=t.selectionStart,r=t.selectionEnd,i=t.selectionDirection??"none",s=t.maxLength,o=t.value,a=this.#a.prev;let p,l=-1,u=-1;if(0!==o.length&&null!==n&&null!==r){const t=n===r,e=n===o.length&&o.length<s;if(t&&!e){const t=n;if(0===t)l=0,u=1,p="forward";else if(t===s)l=t-1,u=t,p="backward";else if(s>1&&o.length>1){let e=0;if(null!==a[0]&&null!==a[1]){p=t<a[0]?"backward":"forward";const n=a[0]===a[1]&&a[0]<s;"backward"!==p||n||(e=-1)}l=e-t,u=e+t+1}}-1!==l&&-1!==u&&l!==u&&this.#t.current?.setSelectionRange(l,u,p)}const c=-1!==l?l:n,h=-1!==u?u:r,d=p??i;this.#r=c,this.#i=h,this.#a.prev=[c,h,d]};oninput=t=>{const e=t.currentTarget.value.slice(0,this.opts.maxLength.current);if(e.length>0&&this.#o()&&!this.#o().test(e))return void t.preventDefault();"string"==typeof this.#s.current&&e.length<this.#s.current.length&&this.domContext.getDocument().dispatchEvent(new Event("selectionchange")),this.opts.value.current=e};onfocus=t=>{const e=this.#t.current;if(e){const t=Math.min(e.value.length,this.opts.maxLength.current-1),n=e.value.length;e.setSelectionRange(t,n),this.#r=t,this.#i=n}this.#n.current=!0};onpaste=t=>{const e=this.#t.current;if(!e)return;const n=t=>{const n=null===e.selectionStart?void 0:e.selectionStart,r=null===e.selectionEnd?void 0:e.selectionEnd,i=n!==r,s=this.opts.value.current;return(i?s.slice(0,n)+t+s.slice(r):s.slice(0,n)+t+s.slice(n)).slice(0,this.opts.maxLength.current)},r=t=>t.length>0&&this.#o()&&!this.#o().test(t);if(!(this.opts.pasteTransformer?.current||this.#l.isIOS&&t.clipboardData&&e)){return void(r(n(t.clipboardData?.getData("text/plain")))&&t.preventDefault())}const i=t.clipboardData?.getData("text/plain")??"",s=this.opts.pasteTransformer?.current?this.opts.pasteTransformer.current(i):i;t.preventDefault();const o=n(s);if(r(o))return;e.value=o,this.opts.value.current=o;const a=Math.min(o.length,this.opts.maxLength.current-1),p=o.length;e.setSelectionRange(a,p),this.#r=a,this.#i=p};onmouseover=t=>{this.#e=!0};onmouseleave=t=>{this.#e=!1};onblur=t=>{this.#a.willSyntheticBlur?this.#a.willSyntheticBlur=!1:this.#n.current=!1};#v=t(()=>({id:this.opts.inputId.current,style:this.#d(),autocomplete:this.opts.autocomplete.current||"one-time-code","data-pin-input-input":"","data-pin-input-input-mss":this.#r,"data-pin-input-input-mse":this.#i,inputmode:this.opts.inputmode.current,pattern:this.#o()?.source,maxlength:this.opts.maxLength.current,value:this.opts.value.current,disabled:u(this.opts.disabled.current),onpaste:this.onpaste,oninput:this.oninput,onkeydown:this.onkeydown,onmouseover:this.onmouseover,onmouseleave:this.onmouseleave,onfocus:this.onfocus,onblur:this.onblur,...this.inputAttachment}));get inputProps(){return this.#v()}set inputProps(t){return this.#v(t)}#g=t(()=>Array.from({length:this.opts.maxLength.current}).map((t,e)=>{const n=this.#n.current&&null!==this.#r&&null!==this.#i&&(this.#r===this.#i&&e===this.#r||e>=this.#r&&e<this.#i),r=void 0!==this.opts.value.current[e]?this.opts.value.current[e]:null;return{char:r,isActive:n,hasFakeCaret:n&&null===r}}));#x=t(()=>({cells:this.#g(),isFocused:this.#n.current,isHovering:this.#e}));get snippetProps(){return this.#x()}set snippetProps(t){return this.#x(t)}}class y{static create(t){return new y(t)}opts;attachment;constructor(t){this.opts=t,this.attachment=p(this.opts.ref)}#S=t(()=>({id:this.opts.id.current,[w.cell]:"","data-active":this.opts.cell.current.isActive?"":void 0,"data-inactive":this.opts.cell.current.isActive?void 0:"",...this.attachment}));get props(){return this.#S()}set props(t){return this.#S(t)}}function E(t,e){try{t.insertRule(e)}catch{}}function $(t,s){t.component(t=>{let a,{ref:p=null,class:l,value:u="",$$slots:m,$$events:v,...g}=s,x=!0;function S(t){t.push("\x3c!----\x3e"),function(t,i){t.component(t=>{const s=e(t);let{id:o=c(s),inputId:a=`${c(s)}-input`,ref:p=null,maxlength:l=6,textalign:u="left",pattern:m,inputmode:v="numeric",onComplete:g=f,pushPasswordManagerStrategy:x="increase-width",class:S="",children:w,autocomplete:b="one-time-code",disabled:y=!1,value:E="",onValueChange:$=f,pasteTransformer:k,$$slots:D,$$events:C,...A}=i;const I=P.create({id:h(()=>o),ref:h(()=>p,t=>p=t),inputId:h(()=>a),autocomplete:h(()=>b),maxLength:h(()=>l),textAlign:h(()=>u),disabled:h(()=>y),inputmode:h(()=>v),pattern:h(()=>m),onComplete:h(()=>g),value:h(()=>E,t=>{E=t,$(t)}),pushPasswordManagerStrategy:h(()=>x),pasteTransformer:h(()=>k)}),R=d(A,I.inputProps),M=d(I.rootProps,{class:S}),T=d(I.inputWrapperProps,{});t.push(`<div${n({...M})}>`),w?.(t,I.snippetProps),t.push(`\x3c!----\x3e <div${n({...T})}><input${n({...R},void 0,void 0,void 0,4)}/></div></div>`),r(i,{ref:p,value:E})})}(t,i([{"data-slot":"input-otp",class:o("has-disabled:opacity-50 flex items-center gap-2 [&_input]:disabled:cursor-not-allowed",l)},g,{get ref(){return p},set ref(t){p=t,x=!1},get value(){return u},set value(t){u=t,x=!1}}])),t.push("\x3c!----\x3e")}do{x=!0,a=t.copy(),S(a)}while(!x);t.subsume(a),r(s,{ref:p,value:u})})}function k(t,e){t.component(t=>{let{ref:i=null,class:a,children:p,$$slots:l,$$events:u,...c}=e;t.push(`<div${n({"data-slot":"input-otp-group",class:s(o("flex items-center",a)),...c})}>`),p?.(t),t.push("\x3c!----\x3e</div>"),r(e,{ref:i})})}function D(t,s){t.component(t=>{let a,{ref:p=null,cell:l,class:u,$$slots:m,$$events:f,...v}=s,g=!0;function S(t){t.push("\x3c!----\x3e"),function(t,i){t.component(t=>{const s=e(t);let{id:o=c(s),ref:a=null,cell:p,child:l,children:u,$$slots:m,$$events:f,...v}=i;const g=y.create({id:h(()=>o),ref:h(()=>a,t=>a=t),cell:h(()=>p)}),x=d(v,g.props);l?(t.push("\x3c!--[--\x3e"),l(t,{props:x}),t.push("\x3c!----\x3e")):(t.push("\x3c!--[!--\x3e"),t.push(`<div${n({...x})}>`),u?.(t),t.push("\x3c!----\x3e</div>")),t.push("\x3c!--]--\x3e"),r(i,{ref:a})})}(t,i([{cell:l,"data-slot":"input-otp-slot",class:o("border-input aria-invalid:border-destructive dark:bg-input/30 relative flex size-9 items-center justify-center border-y border-r text-sm outline-none transition-all first:rounded-l-md first:border-l last:rounded-r-md",l.isActive&&"border-ring ring-ring/50 aria-invalid:border-destructive dark:aria-invalid:ring-destructive/40 aria-invalid:ring-destructive/20 ring-offset-background z-10 ring-[3px]",u)},v,{get ref(){return p},set ref(t){p=t,g=!1},children:t=>{t.push(`\x3c!----\x3e${x(l.char)} `),l.hasFakeCaret?(t.push("\x3c!--[--\x3e"),t.push('<div class="pointer-events-none absolute inset-0 flex items-center justify-center"><div class="animate-caret-blink bg-foreground h-4 w-px duration-1000"></div></div>')):t.push("\x3c!--[!--\x3e"),t.push("\x3c!--]--\x3e")},$$slots:{default:!0}}])),t.push("\x3c!----\x3e")}do{g=!0,a=t.copy(),S(a)}while(!g);t.subsume(a),r(s,{ref:p})})}export{$ as I,k as a,D as b};
