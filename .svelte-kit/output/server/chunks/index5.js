import{v as t,p as e,s as o,m as s,k as r}from"./index.js";import{c as n}from"./rtl-utils.js";import{O as p,p as i,q as c,r as a,u,o as h,P as d}from"./sheet-header.js";import{n as l}from"./noop.js";import{b as f,a as x,d as m,g,h as v,c as $,m as b}from"./create-id.js";import{c as w}from"./button2.js";import"clsx";import{C as y,E as P,S as C,b as O}from"./roving-focus-group.js";const A=m({component:"popover",parts:["root","trigger","content","close"]}),k=new y("Popover.Root");class E{static create(t){return k.set(new E(t))}opts;contentNode=null;triggerNode=null;constructor(t){this.opts=t,new p({ref:f(()=>this.contentNode),open:this.opts.open,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}})}toggleOpen(){this.opts.open.current=!this.opts.open.current}handleClose(){this.opts.open.current&&(this.opts.open.current=!1)}}class N{static create(t){return new N(t,k.get())}opts;root;attachment;constructor(t,e){this.opts=t,this.root=e,this.attachment=x(this.opts.ref,t=>this.root.triggerNode=t),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onclick(t){this.opts.disabled.current||0===t.button&&this.root.toggleOpen()}onkeydown(t){this.opts.disabled.current||t.key!==P&&t.key!==C||(t.preventDefault(),this.root.toggleOpen())}#t(){if(this.root.opts.open.current&&this.root.contentNode?.id)return this.root.contentNode?.id}#e=t(()=>({id:this.opts.id.current,"aria-haspopup":"dialog","aria-expanded":v(this.root.opts.open.current),"data-state":g(this.root.opts.open.current),"aria-controls":this.#t(),[A.trigger]:"",disabled:this.opts.disabled.current,onkeydown:this.onkeydown,onclick:this.onclick,...this.attachment}));get props(){return this.#e()}set props(t){return this.#e(t)}}class j{static create(t){return new j(t,k.get())}opts;root;attachment;constructor(t,e){this.opts=t,this.root=e,this.attachment=x(this.opts.ref,t=>this.root.contentNode=t)}onInteractOutside=t=>{if(this.opts.onInteractOutside.current(t),t.defaultPrevented)return;if(!O(t.target))return;const e=t.target.closest(A.selector("trigger"));if(!e||e!==this.root.triggerNode){if(this.opts.customAnchor.current)if(O(this.opts.customAnchor.current)){if(this.opts.customAnchor.current.contains(t.target))return}else if("string"==typeof this.opts.customAnchor.current){const e=document.querySelector(this.opts.customAnchor.current);if(e&&e.contains(t.target))return}this.root.handleClose()}};onEscapeKeydown=t=>{this.opts.onEscapeKeydown.current(t),t.defaultPrevented||this.root.handleClose()};#o=t(()=>({open:this.root.opts.open.current}));get snippetProps(){return this.#o()}set snippetProps(t){return this.#o(t)}#e=t(()=>({id:this.opts.id.current,tabindex:-1,"data-state":g(this.root.opts.open.current),[A.content]:"",style:{pointerEvents:"auto"},...this.attachment}));get props(){return this.#e()}set props(t){return this.#e(t)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown}}function F(t,p){t.component(t=>{let u,{ref:h=null,class:x,sideOffset:m=4,align:g="center",portalProps:v,$$slots:w,$$events:y,...P}=p,C=!0;function O(t){t.push("\x3c!----\x3e"),d(t,o([v,{children:t=>{t.push("\x3c!----\x3e"),function(t,n){t.component(t=>{const p=e(t);let{child:u,children:h,ref:d=null,id:x=$(p),forceMount:m=!1,onCloseAutoFocus:g=l,onEscapeKeydown:v=l,onInteractOutside:w=l,trapFocus:y=!0,preventScroll:P=!1,customAnchor:C=null,$$slots:O,$$events:A,...k}=n;const E=j.create({id:f(()=>x),ref:f(()=>d,t=>d=t),onInteractOutside:f(()=>w),onEscapeKeydown:f(()=>v),customAnchor:f(()=>C)}),N=b(k,E.props);if(m){t.push("\x3c!--[--\x3e");{let e=function(t,{props:e,wrapperProps:o}){const s=b(e,{style:a("popover")});u?(t.push("\x3c!--[--\x3e"),u(t,{props:s,wrapperProps:o,...E.snippetProps}),t.push("\x3c!----\x3e")):(t.push("\x3c!--[!--\x3e"),t.push(`<div${r({...o})}><div${r({...s})}>`),h?.(t),t.push("\x3c!----\x3e</div></div>")),t.push("\x3c!--]--\x3e")};i(t,o([N,E.popperProps,{ref:E.opts.ref,enabled:E.root.opts.open.current,id:x,trapFocus:y,preventScroll:P,loop:!0,forceMount:!0,customAnchor:C,onCloseAutoFocus:g,popper:e,$$slots:{popper:!0}}]))}}else{if(t.push("\x3c!--[!--\x3e"),m)t.push("\x3c!--[!--\x3e");else{t.push("\x3c!--[--\x3e");{let e=function(t,{props:e,wrapperProps:o}){const s=b(e,{style:a("popover")});u?(t.push("\x3c!--[--\x3e"),u(t,{props:s,wrapperProps:o,...E.snippetProps}),t.push("\x3c!----\x3e")):(t.push("\x3c!--[!--\x3e"),t.push(`<div${r({...o})}><div${r({...s})}>`),h?.(t),t.push("\x3c!----\x3e</div></div>")),t.push("\x3c!--]--\x3e")};c(t,o([N,E.popperProps,{ref:E.opts.ref,open:E.root.opts.open.current,id:x,trapFocus:y,preventScroll:P,loop:!0,forceMount:!1,customAnchor:C,onCloseAutoFocus:g,popper:e,$$slots:{popper:!0}}]))}}t.push("\x3c!--]--\x3e")}t.push("\x3c!--]--\x3e"),s(n,{ref:d})})}(t,o([{"data-slot":"popover-content",dir:"rtl",sideOffset:m,align:g,class:n("bg-popover text-popover-foreground text-right dir-rtl data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--bits-popover-content-transform-origin) outline-hidden z-50 w-72 rounded-md border p-4 shadow-md",x)},P,{get ref(){return h},set ref(t){h=t,C=!1}}])),t.push("\x3c!----\x3e")},$$slots:{default:!0}}])),t.push("\x3c!----\x3e")}do{C=!0,u=t.copy(),O(u)}while(!C);t.subsume(u),s(p,{ref:h})})}function I(t,n){t.component(t=>{let p,{ref:i=null,class:c,$$slots:a,$$events:h,...d}=n,l=!0;function x(t){t.push("\x3c!----\x3e"),function(t,o){t.component(t=>{const n=e(t);let{children:p,child:i,id:c=$(n),ref:a=null,type:h="button",disabled:d=!1,$$slots:l,$$events:x,...m}=o;const g=N.create({id:f(()=>c),ref:f(()=>a,t=>a=t),disabled:f(()=>Boolean(d))}),v=b(m,g.props,{type:h});u(t,{id:c,ref:g.opts.ref,children:t=>{i?(t.push("\x3c!--[--\x3e"),i(t,{props:v}),t.push("\x3c!----\x3e")):(t.push("\x3c!--[!--\x3e"),t.push(`<button${r({...v})}>`),p?.(t),t.push("\x3c!----\x3e</button>")),t.push("\x3c!--]--\x3e")}}),s(o,{ref:a})})}(t,o([{"data-slot":"popover-trigger",class:w("",c)},d,{get ref(){return i},set ref(t){i=t,l=!1}}])),t.push("\x3c!----\x3e")}do{l=!0,p=t.copy(),x(p)}while(!l);t.subsume(p),s(n,{ref:i})})}function K(t,e){let{$$slots:s,$$events:r,...n}=e;I(t,o([n]))}const S=function(t,e){t.component(t=>{let{open:o=!1,onOpenChange:r=l,onOpenChangeComplete:n=l,children:p}=e;E.create({open:f(()=>o,t=>{o=t,r(t)}),onOpenChangeComplete:f(()=>n)}),h(t,{children:t=>{p?.(t),t.push("\x3c!----\x3e")}}),s(e,{open:o})})};export{K as P,S as R,F as a};
